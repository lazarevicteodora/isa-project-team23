<div class="video-detail-container">
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <h1>JutjubiÄ‡</h1>
    </div>
    <div class="navbar-menu">
      <button class="btn btn-back" (click)="goBack()">
        â† PoÄetna
      </button>
    </div>
  </nav>

  <div class="content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <div class="spinner"></div>
      <p>UÄitavanje videa...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !loading" class="error-container">
      <div class="alert alert-error">
        <h2>GreÅ¡ka</h2>
        <p>{{ errorMessage }}</p>
        <button class="btn btn-primary" (click)="goBack()">
          Vrati se na poÄetnu
        </button>
      </div>
    </div>

    <!-- Video Content -->
    <div *ngIf="video && !loading" class="video-content">
      
      <!-- Video Player -->
      <div class="video-player-container">
        <video 
          class="video-player"
          controls
          autoplay>
          <source [src]="'http://localhost:8080/api/videos/' + video.id + '/stream'" type="video/mp4">
          VaÅ¡ pretraÅ¾ivaÄ ne podrÅ¾ava video tag.
        </video>
      </div>

      <!-- Video Info Section -->
      <div class="video-info-section">
        
        <!-- Title -->
        <h1 class="video-title">{{ video.title }}</h1>

        <!-- Meta Info (Views, Date, Author) -->
        <div class="video-meta">
          <span class="meta-item view-count">
            ğŸ‘ï¸ {{ video.viewCount || 0 }} pregleda
          </span>

          <span class="meta-item author" *ngIf="video.authorUsername">
            ğŸ‘¤ 
            <a [routerLink]="['/profile', video.authorId]" class="author-link">
              {{ video.authorUsername }}
            </a>
          </span>
          
          <span class="meta-item date">
            ğŸ“… {{ video.createdAt | parseDate | date:'dd.MM.yyyy HH:mm' }}
          </span>
        </div>

        <!-- Description -->
        <div class="video-description">
          <h3>Opis</h3>
          <p>{{ video.description }}</p>
        </div>

        <!-- Tags -->
        <div class="video-tags" *ngIf="video.tags && video.tags.length > 0">
          <h3>Tagovi</h3>
          <div class="tags-list">
            <span class="tag" *ngFor="let tag of video.tags">
              {{ tag }}
            </span>
          </div>
        </div>

        <!-- Location -->
        <div class="video-location" *ngIf="video.latitude && video.longitude">
          <h3>Lokacija</h3>
          <p>ğŸ“ {{ video.latitude }}, {{ video.longitude }}</p>
        </div>

        <!-- Like Section -->
        <div class="like-section">
          <button 
            (click)="toggleLike()"
            [class.liked]="hasLiked"
            class="btn-like">
            <span class="like-icon">{{ hasLiked ? 'â¤ï¸' : 'ğŸ¤' }}</span>
            {{ likeCount }}
          </button>
        </div>

      </div>

      <!-- Comments Section -->
      <div class="comments-section">
        <h3>Komentari ({{ totalComments }})</h3>
        
        <!-- Add Comment Form (only for logged in users) -->
        <div *ngIf="isAuthenticated" class="comment-form">
          <textarea 
            [(ngModel)]="newComment" 
            placeholder="Dodaj komentar..."
            rows="3"
            [disabled]="submittingComment"
            maxlength="2000">
          </textarea>
          <button 
            (click)="addComment()" 
            [disabled]="!newComment.trim() || submittingComment"
            class="btn-submit">
            {{ submittingComment ? 'Objavljuje se...' : 'Objavi' }}
          </button>
        </div>
        
        <!-- Login Prompt for non-authenticated users -->
        <div *ngIf="!isAuthenticated" class="login-prompt">
          <p>
            ğŸ”’ Morate se <a routerLink="/login" [queryParams]="{returnUrl: '/video/' + video.id}">prijaviti</a> 
            da biste komentarisali.
          </p>
        </div>
        
        <!-- Loading Indicator -->
        <div *ngIf="loadingComments" class="loading-comments">
          <div class="spinner-small"></div>
          <p>UÄitavanje komentara...</p>
        </div>
        
        <!-- Comments List -->
        <div class="comments-list" *ngIf="!loadingComments">
          <div *ngFor="let comment of comments" class="comment">
            <div class="comment-header">
              <span class="comment-author">
                ğŸ‘¤ 
                <a [routerLink]="['/profile', comment.authorId]" class="author-link">
                  {{ comment.authorUsername }}
                </a>
              </span>
              <span class="comment-date">
                ğŸ“… {{ comment.createdAt | parseDate | date:'dd.MM.yyyy HH:mm' }}
              </span>
              <button 
                *ngIf="canDeleteComment(comment)" 
                (click)="deleteComment(comment.id)"
                class="btn-delete">
                ğŸ—‘ï¸ ObriÅ¡i
              </button>
            </div>
            <div class="comment-content">{{ comment.content }}</div>
          </div>
          
          <p *ngIf="comments.length === 0" class="no-comments">
            ğŸ’¬ Nema komentara. Budite prvi!
          </p>
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="totalPages > 1">
          <button 
            (click)="previousPage()" 
            [disabled]="currentPage === 0"
            class="btn-page">
            â† Prethodna
          </button>
          
          <span class="page-info">
            Stranica {{ currentPage + 1 }} od {{ totalPages }}
          </span>
          
          <button 
            (click)="nextPage()" 
            [disabled]="currentPage === totalPages - 1"
            class="btn-page">
            SledeÄ‡a â†’
          </button>
        </div>
      </div>

    </div>
  </div>
</div>